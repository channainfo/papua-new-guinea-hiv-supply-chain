<%= simple_form_for [:admin, @order], :html => { :class => 'form-horizontal' } do |f| %>
  <%= f.error_notification %>
  <div class='row'>
    <div class='span4' >
      <%= f.input :site, :collection => Site.all.map{|site| [site.name, site.id]},:include_blank => 'Select a Site'%>
    </div>

    <div class='span4'>
      <%= f.input :order_date, :as => 'date_time_picker', :label => 'Order Create' %>   
    </div>

    <div class='span4'>
        <%= f.input :date_submittion, :as => 'date_time_picker', :label => 'Order Received' %> 
    </div>
  </div>

  <% i = 0 %>
  <%=f.simple_fields_for :order_lines do |order_line| %>
    <% if(i < @commodities_kit.size) %>
        <%=content_for :kit do  %>
          <tr>
            <td> <%= @order.order_lines[i].commodity.name%> </td>
            <td> </td>
            <td> <%= order_line.input :stock_on_hand, :label=> '&nbsp;',
                  :wrapper_html => {:class => 'inline-div'}, 
                  :input_html =>{:class => 'number_text'}, 
                  :label_html =>{:class => 'none'}  %> 
            </td>
            <td> <%= order_line.input :monthly_use, :label=> '&nbsp;' , 
                  :wrapper_html => {:class => 'inline-div'},
                  :input_html => {:class => 'number_text'} , 
                  :label_html =>{:class => 'none'}%> 
            </td>
            
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>  
        <% end %>    
    <% else %>  
        <%=content_for :drug do %>
          <tr>
            <td> <%= @order.order_lines[i].commodity.name%> </td>
            <td> </td>
            <td> <%= order_line.input :stock_on_hand, :label=> '&nbsp;',
                    :wrapper_html => {:class => 'inline-div'},
                    :input_html =>{:class => 'number_text'}, 
                    :label_html =>{:class => 'none'}  %> </td>
            <td> <%= order_line.input :monthly_use, :label=> '&nbsp;',
                    :wrapper_html => {:class => 'inline-div'},
                    :input_html =>{:class => 'number_text'}, 
                    :label_html =>{:class => 'none'}   %> 
            </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
        <% end %>
    <% end %>  
    <% i += 1 %>
  <% end %>

  <div class="tabbable"> 
    <ul class="nav nav-tabs">
      <li class="active">
        <a href="#drug" data-toggle="tab">Drugs</a>
      </li>
      <li> 
        <a href="#kit" data-toggle="tab">Kit</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="drug">
        <h4> Drug Commodities </h4>
        <%= table_order_line yield(:drug) %>
      </div>
      <div class="tab-pane" id="kit">
         <h4> Kit Commodities </h4>
         <%= table_order_line yield(:kit) %>
      </div>
    </div>
  </div>














        

  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                admin_provinces_path, :class => 'btn' %>
  </div>
<% end %>

<script>
  function handleSiteUser(){
    $('#order_site').on('change', function(){
       var site = $(this).val();
       if(!site){
          removeUsers();
          return ;
       }

       var url  = '/admin/sites/' + site + '/users' 
       $.ajax({
          url : url,
          method : 'GET',
          dataType : 'json',
          success: function(response){
             removeUsers();
             $selectElm = $('#order_user_place_order') ;
             for(var i=0; i< response.length; i++){
                   value = response[i][1];
                   text  = response[i][0];
                   var option = "<option value='"+ value +"' >" + text + " </option>";
                   $selectElm.append(option);
                 }
          }
       })


    });
  }

  function removeUsers(){
      $("#order_user_place_order option[value !='']" ).remove();
  }

  $(function(){
    handleSiteUser();
  });
</script>
