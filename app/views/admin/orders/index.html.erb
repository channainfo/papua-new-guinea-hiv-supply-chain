<%= page_header "Requisition and order"  do  %>

  <% 
    export_options = {}
    export_options[:type] = params[:type]  if !params[:type].blank?   
  %> 

  <% if current_user.data_entry? or current_user.data_entry_and_reviewer? %>
    <%= link_button 'icon-plus' , 'New Order',  new_admin_order_path(), :class => 'btn' %>
  <% end %>
  <%= link_button_download 'Export Orders',  export_admin_orders_path(export_options), :class => 'btn btn-primary' %>  
<% end %>

<% content_for :breadcrumb do %>
  <%= breadcrumb [{"Orders" => nil}]  %>
<% end %>

<table class="table table-hover ">
  <thead>
    <tr>
      <th class='nth-table'>#</th>
      <th>Submission</th>
      <th>Site</th>
      <th>Id</th>
      <th>Order Creation</th>
      <th>Entry</th>
      <th>Reviewer</th>
      <th>Reviewed Date</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>

  <tbody>
    <% @orders.each_with_index do |order, index| %>
      <tr>
        <td><%= current_entries + index %></td>
        <td>
          <% text = "Order #{l(order.date_submittion)}"
              editable = (current_user.data_entry? || current_user.data_entry_and_reviewer?) && order.status !=  Order::ORDER_STATUS_APPROVED
          %>
          <%= editable ? link_to(text, edit_admin_order_path(order)) : text %>
        </td>
        <td><%=order.site.name %></td>
        <td><%= order.id %> </td>
        <td><%= order.order_date ? show_date(order.order_date) : '' %></td>
        <td title='<%= order.user.phone_number%>'> 
          <%=order.user_data_entry ? order.user_data_entry.user_name : ""  %>
        </td>
        <td><%= order.review_user ?  order.review_user.user_name : "" %></td>
        <td><%= order.review_date ? show_date_time(order.review_date) : '' %></td>
        <td><%= order.status %></td>
        
        <td class="center">
          <% if current_user.reviewer? %>
            <%= link_button_review t('Review'), review_admin_order_path(order) %> 

          <% elsif (current_user.data_entry? || current_user.data_entry_and_reviewer? ) && order.status == Order::ORDER_STATUS_PENDING %>
            <%= link_button_delete 'Delete', admin_order_path(order), :method => :delete, :confirm => 'Are you sure to delete this order ?' %>  

          <% elsif current_user.ams? %>
            <%= link_button 'icon-briefcase', 'Shipment', admin_order_shipments_path(order)%>
          <% end %>   

        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= render_paginate_for @orders %>



